<html ng-app="sampleApp">

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.8/angular.min.js"></script>
    <script src="https://cdn.firebase.com/js/client/2.0.6/firebase.js"></script>
    <script src="https://cdn.firebase.com/libs/angularfire/0.9.0/angularfire.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.3.8/angular-route.min.js"></script>
    <script type="text/javascript">
        var app = angular.module("sampleApp", ["firebase", "ngRoute"]);
        // let's create a re-usable factory that generates the $firebaseAuth instance
        app.factory("Auth", ["$firebaseAuth", function($firebaseAuth) {
            var ref = new Firebase("https://glowing-inferno-4287.firebaseio.com/");
            //var ref = new Firebase("https://<replace-with-your-db-id>.firebaseio.com/");
            return $firebaseAuth(ref);
        }]);

        // and use it in our controller
        app.controller("SampleCtrl", ["$scope", "Auth", "$timeout", "$location", "$route", function($scope, Auth, $timeout, $location, $route) {
            $scope.auth = Auth;
            $scope.auth.$onAuth(function(userData) {
                // $timeout needed for AngularFire 0.9.0
                // see https://github.com/firebase/angularfire/issues/510
                $timeout(function() {
                    $scope.user = userData;
                });
                $route.reload();
            });

            $scope.login = function() {
                $scope.auth.$authWithOAuthPopup('facebook')
                    .then(function() {
                        $location.path("/account");
                    });
            }
        }]);

        app.controller("AccountCtrl", ["Auth", function(Auth) {
            this.userData = Auth.$getAuth();
        }]);

        app.run(["$rootScope", "$location", function($rootScope, $location) {
            $rootScope.$on("$routeChangeError", function(event, next, previous, error) {
                // We can catch the error thrown when the $requireAuth promise is rejected
                // and redirect the user back to the home page
                if (error === "AUTH_REQUIRED") {
                    $location.path("/");
                }
            });
        }]);

        app.config(["$routeProvider", function($routeProvider) {
            $routeProvider.when("/", {
                // the rest is the same for ui-router and ngRoute...
                templateUrl: "views/home.html",
                resolve: {
                    // controller will not be loaded until $waitForAuth resolves
                    // Auth refers to our $firebaseAuth wrapper in the example above
                    "currentAuth": ["Auth", function(Auth) {
                        // $waitForAuth returns a promise so the resolve waits for it to complete
                        return Auth.$waitForAuth();
                    }]
                }
            }).when("/account", {
                // the rest is the same for ui-router and ngRoute...
                templateUrl: "views/account.html",
                resolve: {
                    // controller will not be loaded until $requireAuth resolves
                    // Auth refers to our $firebaseAuth wrapper in the example above
                    "currentAuth": ["Auth", function(Auth) {
                        // $requireAuth returns a promise so the resolve waits for it to complete
                        // If the promise is rejected, it will throw a $stateChangeError (see above)
                        return Auth.$requireAuth();
                    }]
                }
            });
        }]);
    </script>
</head>

<body ng-controller="SampleCtrl">
    <div ng-show="user">
        <p>Hello, {{ user.facebook.displayName }}</p>
        <button ng-click="auth.$unauth()">Logout</button>
    </div>
    <div ng-hide="user">
        <p>Welcome, please log in.</p>
        <button ng-click="login()">Login</button>
    </div>
    <hr />
    <div ng-view></div>
    <script type="text/ng-template" id="views/home.html">
        home template.
    </script>
    <script type="text/ng-template" id="views/account.html">
        <div ng-controller="AccountCtrl as accntCtrl">
            account template.
            <br /> Hello from account page, {{accntCtrl.userData.facebook.displayName}}
        </div>
    </script>
</body>

</html>
