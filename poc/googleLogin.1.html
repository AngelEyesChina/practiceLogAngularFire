<html ng-app="sampleApp">

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.0/angular.min.js"></script>
    <script src="https://cdn.firebase.com/js/client/1.1.2/firebase.js"></script>
    <script src="https://cdn.firebase.com/libs/angularfire/0.8.2/angularfire.min.js"></script>
    <script type="text/javascript">
        var app = angular.module("sampleApp", ["firebase"]);
        app.controller("AuthCtrl", ["$scope",
            function($scope) {

                $scope.safeApply = function(fn) {
                    var phase = this.$root.$$phase;
                    if (phase == '$apply' || phase == '$digest') {
                        if (fn && (typeof(fn) === 'function')) {
                            fn();
                        }
                    }
                    else {
                        this.$apply(fn);
                    }
                }

                var ref = new Firebase("https://glowing-inferno-4287.firebaseio.com");
                var auth = this;

                ref.onAuth(_onAuth);

                var authData = ref.getAuth();
                auth.user = {};
                if (authData) {
                    auth.user = authData;
                }


                auth.login = function() {
                    ref.authWithOAuthPopup("google", function(err, authData) {
                        auth.user = authData;
                    });
                };

                auth.logout = function() {
                    ref.unauth();
                    auth.user = {};
                };

                auth.checkIfUserIsLoggedIn = function() {
                    var authData = ref.getAuth();
                    if (authData) {
                        alert(authData.uid);
                    }
                    else {
                        alert("no data");
                    }
                };

                function _onAuth(authData) {
                    if (authData) {
                        // user authenticated with Firebase
                        console.log("User ID: " + authData.uid + ", Provider: " + authData.provider);
                        auth.user = authData;
                    }
                    else {
                        // user is logged out
                        auth.user = {};
                    }
                    auth.authData = JSON.stringify(authData);
                    $scope.safeApply();
                }
            }
        ]);
    </script>
</head>

<body>
    <div ng-controller="AuthCtrl as auth">
        user: {{auth.user.uid}}
        <br />authData: {{auth.authData}}
        <div ng-show="auth.user.uid">
            <p>Hello, {{auth.user.google.displayName}}</p>
            <button ng-click="auth.logout()">Logout</button>
        </div>
        <div ng-hide="auth.user.uid">
            <p>Welcome, please log in.</p>
            <button ng-click="auth.login()">Login</button>
        </div>
        <button ng-click="auth.checkIfUserIsLoggedIn()">checkIfUserIsLoggedIn</button>
    </div>
</body>

</html>
